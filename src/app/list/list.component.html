<div class="list-container">
  <div class="list-header">
    <h2>All Bet Transactions</h2>
    <div class="filter-controls">
      <!-- Search -->
      <input 
        type="text" 
        [(ngModel)]="searchText" 
        (ngModelChange)="applyFilters()"
        placeholder="Search client name..." 
        class="search-input">

      <!-- Race Number Filter -->
      <input 
        type="number" 
        [(ngModel)]="filterRaceNum" 
        (ngModelChange)="applyFilters()"
        placeholder="Race #" 
        class="number-input"
        min="1">

      <!-- Horse Number Filter -->
      <input 
        type="number" 
        [(ngModel)]="filterHorseNum" 
        (ngModelChange)="applyFilters()"
        placeholder="Horse #" 
        class="number-input"
        min="1">

      <!-- Transaction Type Filter -->
      <select [(ngModel)]="filterTransactionType" (ngModelChange)="applyFilters()" class="filter-select">
        <option value="all">All Types</option>
        <option value="Sales">Sales</option>
        <option value="Purchases">Purchases</option>
      </select>

    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading">
    Loading transactions...
  </div>

  <!-- Results Summary -->
  <div *ngIf="!isLoading" class="summary">
    <div class="summary-item">
      <strong>Total Records:</strong> {{ filteredTransactions.length }}
    </div>
    <div class="summary-item">
      <strong>Total Stake:</strong> {{ getTotalStake() | number:'1.0-0' }}
    </div>
  </div>

  <!-- Transactions Cards -->
  <div *ngIf="!isLoading" class="cards-container">
    <mat-card *ngFor="let transaction of filteredTransactions" class="bet-card">
      <mat-card-content>
        <div class="card-header">
          <span class="race-horse-info" [class.cancelled]="transaction.cancel === 1">R:{{ transaction.raceNum }} H:{{ transaction.horseNum }} ({{ transaction.horseName }})</span>
          <span class="transaction-type" [class.type-sales]="transaction.transactionType === 'Sales'" [class.type-purchase]="transaction.transactionType === 'Purchases'">
            {{ transaction.transactionType === 'Sales' ? 'Sales' : 'Purchase' }}
          </span>
        </div>
        
        <div class="card-details">
            <strong>
                <span *ngIf="transaction.isF500">Books: {{ transaction.books }} | F500: {{ transaction.f500 }}</span>
                <span *ngIf="!transaction.isF500">Stake: {{ transaction.stake }} | Odds: {{ transaction.odds100 }}</span>
                <span *ngIf="transaction.tax > 0"> | Tax: {{ transaction.tax }}</span>
            </strong>

        </div>
        
        <div class="card-client" [class.cancelled]="transaction.cancel === 1">
          {{ transaction.clientName }}
          <span *ngIf="transaction.cancel === 1" class="cancel-label">CANCEL</span>
        </div>
        
        <div class="card-footer">
          <div class="footer-left">
            <span class="timestamp">{{ formatDate(transaction.timestamp) }}</span>
            <span class="payout">Payout: {{ transaction.payout | number:'1.0-0' }}</span>
          </div>
          <button 
            class="cancel-button" 
            [class.cancelled]="transaction.cancel === 1"
            (click)="cancelTransaction(transaction)">
            {{ transaction.cancel === 1 ? 'Uncancel' : 'Cancel' }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- No Data Message -->
    <div *ngIf="filteredTransactions.length === 0" class="no-data">
      No transactions found.
    </div>
  </div>

  <!-- Old Table (keeping structure in case needed) -->
  <div *ngIf="false" class="table-container">
    <table mat-table [dataSource]="filteredTransactions" class="transactions-table">
      
      <!-- Timestamp Column -->
      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef>Date/Time</th>
        <td mat-cell *matCellDef="let transaction">{{ formatDate(transaction.timestamp) }}</td>
      </ng-container>

      <!-- Market Type Column -->
      <ng-container matColumnDef="marketType">
        <th mat-header-cell *matHeaderCellDef>Market</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.marketType }}</td>
      </ng-container>

      <!-- Race Number Column -->
      <ng-container matColumnDef="raceNum">
        <th mat-header-cell *matHeaderCellDef>Race</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.raceNum }}</td>
      </ng-container>

      <!-- Horse Number Column -->
      <ng-container matColumnDef="horseNum">
        <th mat-header-cell *matHeaderCellDef>Horse #</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.horseNum }}</td>
      </ng-container>

      <!-- Horse Name Column -->
      <ng-container matColumnDef="horseName">
        <th mat-header-cell *matHeaderCellDef>Horse Name</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.horseName }}</td>
      </ng-container>

      <!-- Client Name Column -->
      <ng-container matColumnDef="clientName">
        <th mat-header-cell *matHeaderCellDef>Client</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.clientName }}</td>
      </ng-container>

      <!-- Transaction Type Column -->
      <ng-container matColumnDef="transactionType">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let transaction">
          <span [class]="transaction.transactionType === 'Sales' ? 'type-sales' : 'type-purchase'">
            {{ transaction.transactionType === 'Sales' ? 'S' : 'P' }}
          </span>
        </td>
      </ng-container>

      <!-- Books Column -->
      <ng-container matColumnDef="books">
        <th mat-header-cell *matHeaderCellDef>Books</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.books || '-' }}</td>
      </ng-container>

      <!-- Stake Column -->
      <ng-container matColumnDef="stake">
        <th mat-header-cell *matHeaderCellDef>Stake</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.stake | number:'1.0-0' }}</td>
      </ng-container>

      <!-- F500 Column -->
      <ng-container matColumnDef="f500">
        <th mat-header-cell *matHeaderCellDef>F500</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.f500 || '-' }}</td>
      </ng-container>

      <!-- Odds100 Column -->
      <ng-container matColumnDef="odds100">
        <th mat-header-cell *matHeaderCellDef>Odds</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.odds100 || '-' }}</td>
      </ng-container>

      <!-- Payout Column -->
      <ng-container matColumnDef="payout">
        <th mat-header-cell *matHeaderCellDef>Payout</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.payout | number:'1.0-0' }}</td>
      </ng-container>

      <!-- Tax Column -->
      <ng-container matColumnDef="tax">
        <th mat-header-cell *matHeaderCellDef>Tax</th>
        <td mat-cell *matCellDef="let transaction">{{ transaction.tax || 0 }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- No Data Message -->
    <div *ngIf="filteredTransactions.length === 0" class="no-data">
      No transactions found.
    </div>
  </div>
</div>
